// Regional and National Exams Data with Automatic Year Sorting
const examSubjects = {
    "first-bac": {
        "title": "امتحانات جهوية - الأولى بكالوريا",
        "subjects": {
            "islamic-education": {
                "name": "التربية الإسلامية",
                "icon": "🕌",
                "exams": [
                    {
                        "title": "امتحان جهوي 2024",
                        "date": "2024-06-15",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2023",
                        "date": "2023-06-16",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2022",
                        "date": "2022-06-17",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2021",
                        "date": "2021-06-18",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2020",
                        "date": "2020-06-19",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "social-studies": {
                "name": "الاجتماعيات",
                "icon": "🌍",
                "exams": [
                    {
                        "title": "امتحان جهوي 2024",
                        "date": "2024-06-12",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2023",
                        "date": "2023-06-13",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2022",
                        "date": "2022-06-14",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2021",
                        "date": "2021-06-15",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2020",
                        "date": "2020-06-16",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "arabic": {
                "name": "اللغة العربية",
                "icon": "📝",
                "exams": [
                    {
                        "title": "امتحان جهوي 2024",
                        "date": "2024-06-10",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2023",
                        "date": "2023-06-11",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2022",
                        "date": "2022-06-12",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2021",
                        "date": "2021-06-13",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2020",
                        "date": "2020-06-14",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "french": {
                "name": "اللغة الفرنسية",
                "icon": "🇫🇷",
                "exams": [
                    {
                        "title": "امتحان جهوي 2024",
                        "date": "2024-06-08",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2023",
                        "date": "2023-06-09",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2022",
                        "date": "2022-06-10",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2021",
                        "date": "2021-06-11",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2020",
                        "date": "2020-06-12",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "mathematics": {
                "name": "الرياضيات",
                "icon": "📐",
                "exams": [
                    {
                        "title": "امتحان جهوي 2024",
                        "date": "2024-06-05",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2023",
                        "date": "2023-06-06",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2022",
                        "date": "2022-06-07",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2021",
                        "date": "2021-06-08",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان جهوي 2020",
                        "date": "2020-06-09",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            }
        }
    },
    "second-bac": {
        "title": "امتحانات وطنية - الثانية بكالوريا",
        "subjects": {
            "physics": {
                "name": "الفيزياء",
                "icon": "⚛️",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-20",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-21",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-22",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-23",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-24",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "biology": {
                "name": "علوم الحياة والأرض",
                "icon": "🧬",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-18",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-19",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-20",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-21",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-22",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "english": {
                "name": "الإنجليزية",
                "icon": "🇬🇧",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-16",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-17",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-18",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-19",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-20",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "philosophy": {
                "name": "الفلسفة",
                "icon": "🤔",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-14",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-15",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-16",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-17",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-18",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "mathematics": {
                "name": "الرياضيات",
                "icon": "📐",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-12",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-13",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-14",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-15",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-16",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            },
            "social-studies": {
                "name": "الاجتماعيات",
                "icon": "🌍",
                "exams": [
                    {
                        "title": "امتحان وطني 2024",
                        "date": "2024-06-10",
                        "year": 2024,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2023",
                        "date": "2023-06-11",
                        "year": 2023,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2022",
                        "date": "2022-06-12",
                        "year": 2022,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2021",
                        "date": "2021-06-13",
                        "year": 2021,
                        "downloadUrl": "#"
                    },
                    {
                        "title": "امتحان وطني 2020",
                        "date": "2020-06-14",
                        "year": 2020,
                        "downloadUrl": "#"
                    }
                ]
            }
        },
        "physics": [
            {
                "title": "تجربي",
                "year": 2026,
                "fileUrl": "https://replit.com/@storelab225/FFFFFFD",
                "correctionUrl": "https://replit.com/@storelab225/FFFFFFD",
                "addedAt": "2025-09-08T15:48:05.157Z"
            }
        ]
    }
};

// باقي الكود الأصلي للملف

// Function to automatically sort exams by year (newest first)
function sortExamsByYear(exams) {
    return exams.sort((a, b) => b.year - a.year);
}

// Navigation function from homepage
function navigateToExams(level) {
    window.location.href = `exams.html?level=${level}`;
}

// Initialize exams page
document.addEventListener('DOMContentLoaded', function() {
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const level = urlParams.get('level');
    const subject = urlParams.get('subject');

    if (!level && window.location.pathname.includes('exams.html')) {
        // Redirect to homepage if no level specified
        window.location.href = 'index.html';
        return;
    }

    if (level && !subject) {
        // Show subjects for the selected level
        displayLevelSubjects(level);
    } else if (level && subject) {
        // Show exams for the selected subject
        displaySubjectExams(level, subject);
    }
});

function displayLevelSubjects(level) {
    const levelData = examSubjects[level];
    if (!levelData) {
        document.getElementById('exams-container').innerHTML = '<div class="error">مستوى غير متاح</div>';
        return;
    }

    // Update page title
    document.getElementById('page-title').textContent = levelData.title;
    
    const container = document.getElementById('exams-container');
    const subjects = Object.entries(levelData.subjects);

    container.innerHTML = `
        <div class="subjects-grid">
            ${subjects.map(([key, subject]) => `
                <div class="subject-exam-card" onclick="selectSubject('${level}', '${key}')">
                    <div class="subject-icon-large">${subject.icon}</div>
                    <h3>${subject.name}</h3>
                    <p>${subject.exams.length} امتحان متاح</p>
                    <div class="years-preview">
                        ${subject.exams.slice(0, 3).map(exam => `<span>${exam.year}</span>`).join('')}
                        ${subject.exams.length > 3 ? '<span>...</span>' : ''}
                    </div>
                    <button class="view-exams-btn">عرض الامتحانات</button>
                </div>
            `).join('')}
        </div>
    `;

    // Add animation
    setTimeout(() => {
        const cards = container.querySelectorAll('.subject-exam-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 150);
        });
    }, 100);
}

function selectSubject(level, subjectKey) {
    window.location.href = `exams.html?level=${level}&subject=${subjectKey}`;
}

function displaySubjectExams(level, subjectKey) {
    const levelData = examSubjects[level];
    const subjectData = levelData?.subjects[subjectKey];
    
    if (!subjectData) {
        document.getElementById('exams-container').innerHTML = '<div class="error">مادة غير متاحة</div>';
        return;
    }

    // Update page title
    document.getElementById('page-title').textContent = `امتحانات ${subjectData.name}`;
    
    // Sort exams by year (newest first)
    const sortedExams = sortExamsByYear([...subjectData.exams]);
    
    const container = document.getElementById('exams-container');
    
    container.innerHTML = `
        <div class="subject-header-info">
            <div class="subject-icon-large">${subjectData.icon}</div>
            <h2>${subjectData.name}</h2>
            <p>${levelData.title}</p>
            <button class="back-to-subjects-btn" onclick="window.history.back()">← العودة للمواد</button>
        </div>
        
        <div class="exams-grid">
            ${sortedExams.map((exam, index) => `
                <div class="exam-card" data-year="${exam.year}">
                    <div class="exam-year">${exam.year}</div>
                    <h3>${exam.title}</h3>
                    <div class="exam-date">
                        <span class="date-icon">📅</span>
                        <span>${formatDate(exam.date)}</span>
                    </div>
                    <button class="download-exam-btn" onclick="downloadExam('${exam.title}', '${exam.downloadUrl}')">
                        <span>تحميل الامتحان</span>
                        <span class="download-icon">⬇️</span>
                    </button>
                </div>
            `).join('')}
        </div>
    `;

    // Add animation
    setTimeout(() => {
        const cards = container.querySelectorAll('.exam-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    }, 200);
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { year: 'numeric', month: 'long', day: 'numeric' 