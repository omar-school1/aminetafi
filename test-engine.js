
// محرك الاختبارات - JavaScript
// هذا الملف مسؤول عن تشغيل الاختبارات وإدارة الأسئلة والأوقات والنتائج

// المتغيرات العامة لحالة الاختبار
let currentQuestionIndex = 0;        // فهرس السؤال الحالي (يبدأ من 0)
let userAnswers = [];                // مصفوفة تحفظ إجابات المستخدم
let testData = {};                   // بيانات الاختبار (الأسئلة والإجابات)
let questionTimeRemaining = 60;      // الوقت المتبقي للسؤال الحالي (60 ثانية لكل سؤال)
let questionTimerInterval;           // متغير لإدارة مؤقت السؤال الحالي

// قاعدة بيانات الأسئلة النموذجية
// هذا الكائن يحتوي على جميع الاختبارات المتاحة مقسمة حسب المستوى والمادة
// البنية: مستوى-مادة (مثل: first-bac-french)
const sampleQuestions = {
    "first-bac-french": {
        "title": "اختبار الفرنسية - الأولى بكالوريا",
        "duration": 45,
        "questions": [
            {
                "question": "Quelle est la forme correcte du pluriel de \"œil\"?",
                "options": [
                    "œils",
                    "yeux",
                    "œils",
                    "oeux"
                ],
                "correct": 1
            },
            {
                "question": "Complétez: \"Si j'avais de l'argent, j' ____ une voiture.\"",
                "options": [
                    "achèterais",
                    "achèterai",
                    "achète",
                    "ai acheté"
                ],
                "correct": 0
            }
        ]
    },
    "first-bac-arabic": {
        "title": "اختبار العربية - الأولى بكالوريا",
        "duration": 40,
        "questions": [
            {
                "question": "ما إعراب كلمة \"طالباً\" في جملة \"رأيت طالباً مجتهداً\"؟",
                "options": [
                    "مفعول به منصوب",
                    "فاعل مرفوع",
                    "خبر مرفوع",
                    "مضاف إليه مجرور"
                ],
                "correct": 0
            },
            {
                "question": "أي من البحور التالية من البحور الصافية؟",
                "options": [
                    "الطويل",
                    "الكامل",
                    "الوافر",
                    "جميع ما سبق"
                ],
                "correct": 3
            },
            {
                "question": "ما نوع الأسلوب في \"يا طالب العلم اجتهد\"؟",
                "options": [
                    "خبري",
                    "إنشائي طلبي",
                    "إنشائي غير طلبي",
                    "تعجبي"
                ],
                "correct": 1
            }
        ]
    },
    "first-bac-social": {
        "title": "اختبار الاجتماعيات - الأولى بكالوريا",
        "duration": 35,
        "questions": [
            {
                "question": "متى بدأت الحرب العالمية الأولى؟",
                "options": [
                    "1914",
                    "1915",
                    "1916",
                    "1917"
                ],
                "correct": 0
            },
            {
                "question": "ما هي عاصمة المغرب؟",
                "options": [
                    "الدار البيضاء",
                    "الرباط",
                    "فاس",
                    "مراكش"
                ],
                "correct": 1
            },
            {
                "question": "أي قارة تضم أكبر عدد من الدول؟",
                "options": [
                    "آسيا",
                    "أفريقيا",
                    "أوروبا",
                    "أمريكا الجنوبية"
                ],
                "correct": 1
            }
        ]
    },
    "first-bac-islamic": {
        "title": "اختبار التربية الإسلامية - الأولى بكالوريا",
        "duration": 34,
        "questions": [
            {
                "question": "الإيمان هو التصديق القطعي بالله، ويكفي فيه التصديق اللساني المرتبط بالنية دون أن يظهر على الأفعال.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان هو التصديق القطعي بالله، إقرارا باللسان، وتصديقا كاملا بالقلب، وعملا بالجوارح.",
                    "خطأ، الإيمان يعني فقط الإيمان القلبي.",
                    "خطأ، الإيمان يعتمد فقط على الأفعال."
                ],
                "correct": 1
            },
            {
                "question": "حقيقة الإيمان تكمن في البوح بها للناس، وإخبارهم بذلك حتى يعلموا بأنك مؤمن بالله وحده لا شريك له.",
                "options": [
                    "صحيح",
                    "خطأ، وتتجلى حقيقة الإيمان في الصلة الوثيقة بين القول والفعل.",
                    "خطأ، الإيمان لا يحتاج لإخبار الآخرين.",
                    "خطأ، الإيمان هو حالة خاصة بين العبد وربه."
                ],
                "correct": 1
            },
            {
                "question": "من جماليات الإيمان أنه لا شروط له، يكفي فيه التعبير عن رغبة الانتساب لهذا الدين وكفى.",
                "options": [
                    "صحيح",
                    "خطأ، للتحقق بالإيمان لابد من الحفاظ على أركانه الستة.",
                    "خطأ، الإيمان مرتبط بنية القلب فقط.",
                    "خطأ، يكفي أن تردد الشهادتين فقط."
                ],
                "correct": 1
            },
            {
                "question": "الغيب هو كل ما غاب عن العقول الصغيرة التي لا تلتزم بمعالم الدين، ولا تتعبد لله.",
                "options": [
                    "صحيح",
                    "خطأ، هو كل ما غاب عن إدراك الحس، وخفي عن الإنس والجن.",
                    "خطأ، الغيب هو ما يمكن إدراكه بالعقل.",
                    "خطأ، الغيب هو ما لا يمكن فهمه."
                ],
                "correct": 1
            },
            {
                "question": "تنعكس معالم الإيمان بالغيب على سلوكات الأفراد في معاملاتهم مع الناس مسلمين كانوا أو غير مسلمين.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان يؤثر فقط على حياة المسلم.",
                    "خطأ، الغيب ليس له تأثير على السلوك.",
                    "خطأ، الإيمان يؤثر فقط في العلاقة مع الله."
                ],
                "correct": 0
            },
            {
                "question": "يوجب ديننا الإيمان بكل شيء لا علم لنا به، مادياً كان أو معنوياً، وهذا عين الغيب.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان القطعي مرتبط بما أخبرنا به الله تعالى فقط.",
                    "خطأ، يجب الإيمان بكل شيء حتى لا نخطئ.",
                    "خطأ، الإيمان يعتمد على التجربة فقط."
                ],
                "correct": 1
            },
            {
                "question": "العقل هو أساس الإيمان، فما قبله العقل هو حق، وما لم يقبله هو باطل.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان يحث على إعمال العقل، شريطة أن يلتزم بالحق.",
                    "خطأ، العقل ليس له تأثير على الإيمان.",
                    "خطأ، الإيمان يتجاوز العقل."
                ],
                "correct": 1
            },
            {
                "question": "للإيمان بالغيب آثار في الآخرة بالفلاح ودخول الجنة، ولا يمكن اعتبار أن له انعكاسات في الدنيا.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان بالغيب تنعكس آثاره على سلوكيات الأفراد.",
                    "خطأ، الإيمان لا يؤثر على الدنيا.",
                    "خطأ، الإيمان يسبب مشاكل في الدنيا."
                ],
                "correct": 1
            },
            {
                "question": "أزمات المجتمع التي نعيشها في الواقع سببها الانشغال بالإيمان الذي يحث على العبادة وترك الدنيا.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان الحق يشمل جميع مناحي الحياة.",
                    "خطأ، الإيمان يؤثر سلباً على المجتمع.",
                    "خطأ، الإيمان ليس له تأثير على الأزمات."
                ],
                "correct": 1
            },
            {
                "question": "العلم هو طريق لمعرفة الله وترسيخ الإيمان شريطة أن يكون هذا العلم إسلامي فقط.",
                "options": [
                    "صحيح",
                    "خطأ، كل العلوم تعد طريق لمعرفة الله.",
                    "خطأ، يجب أن يكون العلم في الدين فقط.",
                    "خطأ، العلم ليس له علاقة بالله."
                ],
                "correct": 1
            },
            {
                "question": "النبي صلى الله عليه وسلم كان يحث على تعلم اللغة، وطلب العلم، حتى ولو كان هذا العلم يخص الكفار.",
                "options": [
                    "صحيح",
                    "خطأ، لا يجب تعلم علم الكفار.",
                    "خطأ، العلم يجب أن يكون إسلامياً فقط.",
                    "خطأ، العلم ليس له أهمية في الإسلام."
                ],
                "correct": 0
            },
            {
                "question": "جميع العلوم دالة على عظمة الله، وترسخ الإيمان بالله سواء كانت رياضيات أو فيزياء أو فلك.",
                "options": [
                    "صحيح",
                    "خطأ، العلوم الطبيعية لا تتعلق بالإيمان.",
                    "خطأ، فقط العلوم الدينية تدل على عظمة الله.",
                    "خطأ، العلوم تشتت الإيمان."
                ],
                "correct": 0
            },
            {
                "question": "كلما تعلم الإنسان إلا وزاد إيمانه، وكلما زاد إيمانه تقوى قربه من الله.",
                "options": [
                    "صحيح",
                    "خطأ، التعلم لا يؤثر على الإيمان.",
                    "خطأ، التعلم قد يؤدي إلى الشك.",
                    "خطأ، الإيمان مستقل عن المعرفة."
                ],
                "correct": 0
            },
            {
                "question": "يقال إن العلم يتكامل مع الإيمان في جزئيات كثيرة، ولا يتعارضان إلا في جزئية واحدة أو جزئيتين.",
                "options": [
                    "صحيح",
                    "خطأ، لا يوجد أي تعارض بين الإيمان والعلم.",
                    "خطأ، العلم والإيمان يتعارضان في كثير من الأحيان.",
                    "خطأ، الإيمان هو فقط ما يمكن تصديقه."
                ],
                "correct": 1
            },
            {
                "question": "التفكير الفلسفي هو عملية ذهنية قائمة على إعمال العقل بالتأمل في العديد من الظواهر الكونية والعلمية.",
                "options": [
                    "صحيح",
                    "خطأ، التفكير الفلسفي لا يفيد في الإيمان.",
                    "خطأ، التفكير الفلسفي يبعد عن الحق.",
                    "خطأ، التفكير الفلسفي هو مجرد شك."
                ],
                "correct": 0
            },
            {
                "question": "من سلبيات التفكير الفلسفي أنه يقود أحياناً إلى الكفر والإلحاد.",
                "options": [
                    "صحيح",
                    "خطأ، التفكير الفلسفي الحق دائماً يرسخ الإيمان.",
                    "خطأ، الفلسفة لا تفيد في شيء.",
                    "خطأ، التفكير الفلسفي هو طريق الإيمان فقط."
                ],
                "correct": 1
            },
            {
                "question": "ما دام أن الفلسفة قائمة على الإلحاد، وغايتها الوصول إلى الحقيقة، إذا فلا مجال لارتباطها بالإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، الفلسفة كمنهج يرتبط مع الإيمان.",
                    "خطأ، الفلسفة لا تتعلق بالإيمان.",
                    "خطأ، الإيمان هو فقط ما ينقله الوحي."
                ],
                "correct": 1
            },
            {
                "question": "يرتبط المنهج الفلسفي الموضوعي بالمنهج التأملي، والمنهج العقلي، والمنهج التحليلي.",
                "options": [
                    "صحيح",
                    "خطأ، المنهج الفلسفي لا يتعلق بالتأمل.",
                    "خطأ، المنهج الفلسفي هو منهج ديني فقط.",
                    "خطأ، المنهج الفلسفي يعتمد على الإيمان فقط."
                ],
                "correct": 0
            },
            {
                "question": "المنهج الفلسفي الموضوعي يعطيك ملكة التأمل في ذات الله ومعرفة كل جزئيات، وهذا ما يحث عليه الإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، التأمل في ذات الله محرم.",
                    "خطأ، المنهج الفلسفي لا يفيد في الإيمان.",
                    "خطأ، المنهج الفلسفي يعتمد على الشك."
                ],
                "correct": 1
            },
            {
                "question": "الإيمان يحث على إعمال العقل، والفلسفة تحث على التخلص من الإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، كلاهما يشتركان في إعمال العقل.",
                    "خطأ، الفلسفة لا تتعلق بالإيمان.",
                    "خطأ، الإيمان يقيد العقل."
                ],
                "correct": 1
            },
            {
                "question": "من صفات الفلسفة الراشدة أن تجمع بين النقل (الوحي) والعقل.",
                "options": [
                    "صحيح",
                    "خطأ، الفلسفة لا تتعلق بالدين.",
                    "خطأ، الفلسفة تعتمد على العقل فقط.",
                    "خطأ، النقل لا يفيد في الفلسفة."
                ],
                "correct": 0
            },
            {
                "question": "صلح الحديبية تم بين المسلمين وكفار قريش بمكان قرب المدينة اسمه الحديبية.",
                "options": [
                    "صحيح",
                    "خطأ، صلح الحديبية تم بين المسلمين وكفار قريش بمكان قرب مكة اسمه الحديبية.",
                    "خطأ، صلح الحديبية تم بين المسلمين واليهود قرب مكة.",
                    "خطأ، تم الصلح في المدينة."
                ],
                "correct": 1
            },
            {
                "question": "صلح الحديبية تم في شهر ذي الحجة سنة 5 للهجرة.",
                "options": [
                    "صحيح",
                    "خطأ، صلح الحديبية تم في شهر ذي القعدة سنة 6 للهجرة.",
                    "خطأ، صلح الحديبية تم في شهر رجب سنة 5 للهجرة.",
                    "خطأ، تم في شهر رمضان."
                ],
                "correct": 1
            },
            {
                "question": "سبب صلح الحديبية أن رسول الله صلى الله عليه وسلم رأى رؤيا في المنام (وهو بالمدينة) أنه دخل هو وأصحابه المسجد الحرام.",
                "options": [
                    "صحيح",
                    "خطأ، بل كان السبب دعوة من كفار قريش للصلح.",
                    "خطأ، السبب كان لحماية المسلمين من الأذى في مكة.",
                    "خطأ، لم تكن هناك رؤيا."
                ],
                "correct": 0
            },
            {
                "question": "خرج الرسول صلى الله عليه وسلم يريد العمرة ومعه 1400 من الصحابة مسلحين للحرب.",
                "options": [
                    "صحيح",
                    "خطأ، خرج الرسول صلى الله عليه وسلم، يريد العمرة ومعه 1400 من الصحابة بشكل سلمي لا غرض لهم في الحرب.",
                    "خطأ، بل خرج ومعه 1000 من الصحابة فقط.",
                    "خطأ، خرج مسلحاً للقتال."
                ],
                "correct": 1
            },
            {
                "question": "الزواج هو ميثاق يتفق حوله الزوج مع الزوجة على أساس بناء علاقة شرعية محددة بزمان ومكان.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج ميثاق غليظ قائم على المودة والرحمة.",
                    "خطأ، الزواج عقد مؤقت.",
                    "خطأ، الزواج لا يحتاج لاتفاق."
                ],
                "correct": 1
            },
            {
                "question": "الزواج محرم في حق من لا يملك أموال كثيرة، وأملاك وأراضي.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج ليس مرتبطاً بكثرة المال.",
                    "خطأ، يشترط المال الكثير.",
                    "خطأ، الزواج فقط للأغنياء."
                ],
                "correct": 1
            },
            {
                "question": "الحكم الأصلي للزواج هو الإباحة.",
                "options": [
                    "صحيح",
                    "خطأ، الحكم الأصلي هو الاستحباب.",
                    "خطأ، الحكم الأصلي هو الوجوب.",
                    "خطأ، الحكم الأصلي هو الكراهة."
                ],
                "correct": 1
            },
            {
                "question": "شرع الله الزواج، وأحل معه خيار توثيقه على الدوام أو بالمدة المحددة.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج المؤقت محرم في الإسلام.",
                    "خطأ، فقط الزواج الدائم مشروع.",
                    "خطأ، كلاهما محرم."
                ],
                "correct": 1
            },
            {
                "question": "للزواج أكثر من حكم شرعي في الإسلام.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج له حكم واحد فقط.",
                    "خطأ، دائمًا محرم.",
                    "خطأ، دائماً مستحب."
                ],
                "correct": 0
            },
            {
                "question": "أركان الزواج أربعة وهي: الصيغة، الولي، الاشهاد، العقد.",
                "options": [
                    "صحيح",
                    "خطأ، الأركان ثلاثة: الصيغة والولي والشاهدان.",
                    "خطأ، الأركان خمسة.",
                    "خطأ، لا توجد أركان للزواج."
                ],
                "correct": 1
            },
            {
                "question": "الحقوق هي المصالح الثابتة للفرد أو الجماعة المادية أو المعنوية التي يقرها الشرع أو القانون.",
                "options": [
                    "صحيح",
                    "خطأ، الحقوق فقط ما يقره الشرع.",
                    "خطأ، الحقوق فقط مادية.",
                    "خطأ، لا توجد حقوق ثابتة."
                ],
                "correct": 0
            },
            {
                "question": "الحقوق في الإسلام هي ربانية المصدر، وملزمة ومرتبطة بالجزاء، وشاملة لجميع التخصصات.",
                "options": [
                    "صحيح",
                    "خطأ، الحقوق ليست ربانية المصدر.",
                    "خطأ، الحقوق غير ملزمة.",
                    "خطأ، الحقوق محدودة النطاق."
                ],
                "correct": 0
            },
            {
                "question": "الأمانة هي صفة نفسية وقلبية عالمية يعف بها الإنسان عن حقوق الآخرين.",
                "options": [
                    "صحيح",
                    "خطأ، الأمانة صفة محلية فقط.",
                    "خطأ، الأمانة لا تتعلق بحقوق الآخرين.",
                    "خطأ، الأمانة ليست صفة قلبية."
                ],
                "correct": 0
            },
            {
                "question": "الوفاء بالأمانة والمسؤولية يساهم في نشر الثقة بين أفراد المجتمع.",
                "options": [
                    "صحيح",
                    "خطأ، لا يؤثر على الثقة.",
                    "خطأ، يقلل من الثقة.",
                    "خطأ، لا علاقة له بالمجتمع."
                ],
                "correct": 0
            },
            {
                "question": "الصبر هو قدرة الإنسان على تحمل الشدائد والابتلاءات دون جزع.",
                "options": [
                    "صحيح",
                    "خطأ، الصبر هو عدم المقاومة.",
                    "خطأ، الصبر هو الاستسلام.",
                    "خطأ، الصبر لا يتعلق بالابتلاءات."
                ],
                "correct": 0
            },
            {
                "question": "اليقين هو العلم الراسخ الذي لا يعكره شك.",
                "options": [
                    "صحيح",
                    "خطأ، اليقين هو الشك المبرر.",
                    "خطأ، اليقين هو الظن القوي.",
                    "خطأ، اليقين متغير."
                ],
                "correct": 0
            },
            {
                "question": "العفو هو التجاوز عن المذنب مع القدرة على معاقبته.",
                "options": [
                    "صحيح",
                    "خطأ، العفو هو عدم القدرة على المعاقبة.",
                    "خطأ، العفو هو الانتقام.",
                    "خطأ، العفو هو التجاهل."
                ],
                "correct": 0
            },
            {
                "question": "التسامح هو التساهل واليسر في المعاملات المالية والاجتماعية.",
                "options": [
                    "صحيح",
                    "خطأ، التسامح هو التشدد.",
                    "خطأ، التسامح لا يشمل المعاملات.",
                    "خطأ، التسامح فقط في الدين."
                ],
                "correct": 0
            },
            {
                "question": "العفو والتسامح هما صفات يمكن أن تتواجد في حق المذنبين فقط.",
                "options": [
                    "صحيح",
                    "خطأ، العفو والتسامح صفات عامة في التعامل.",
                    "خطأ، لا يوجد عفو للمذنبين.",
                    "خطأ، التسامح فقط مع الأبرياء."
                ],
                "correct": 1
            },
            {
                "question": "الوفاء بالعقود يعتبر واجبًا في الإسلام.",
                "options": [
                    "صحيح",
                    "خطأ، الوفاء بالعقود مستحب فقط.",
                    "خطأ، العقود غير ملزمة.",
                    "خطأ، يجوز نقض العقود."
                ],
                "correct": 0
            },
            {
                "question": "العفة هي خلق يلتزم به الفرد في حياتهم اليومية.",
                "options": [
                    "صحيح",
                    "خطأ، العفة فقط في المناسبات.",
                    "خطأ، العفة غير ضرورية.",
                    "خطأ، العفة للنساء فقط."
                ],
                "correct": 0
            },
            {
                "question": "الحياء هو خلق ينبع من الفرد ليجنب نفسه الفعل القبيح.",
                "options": [
                    "صحيح",
                    "خطأ، الحياء هو الخجل فقط.",
                    "خطأ، الحياء هو الضعف.",
                    "خطأ، الحياء لا يمنع القبائح."
                ],
                "correct": 0
            },
            {
                "question": "العفة والحياء يساهمان في الحد من الفواحش في المجتمع.",
                "options": [
                    "صحيح",
                    "خطأ، لا يؤثران على المجتمع.",
                    "خطأ، يزيدان من الفواحش.",
                    "خطأ، لا علاقة لهما بالفواحش."
                ],
                "correct": 0
            },
            {
                "question": "الفواحش تشمل جميع القبيح من الكلمات والأفعال.",
                "options": [
                    "صحيح",
                    "خطأ، الفواحش فقط الأفعال.",
                    "خطأ، الفواحش فقط الكلمات.",
                    "خطأ، لا توجد فواحش."
                ],
                "correct": 0
            },
            {
                "question": "عمارة الأرض وإعمارها واجب على كل مؤمن ومؤمنة، ومن أفسد فيها يعد من الفاسدين في الأرض.",
                "options": [
                    "صحيح",
                    "خطأ، الإفساد ليس له تأثير.",
                    "خطأ، عمارة الأرض ليست واجباً.",
                    "خطأ، المؤمنين ليسوا ملزمين بذلك."
                ],
                "correct": 0
            },
            {
                "question": "عمارة الأرض هي تعميرها بالانتفاع بخيراتها المادية فقط.",
                "options": [
                    "صحيح",
                    "خطأ، عمارة الأرض تشمل العمل الصالح مادياً ومعنوياً.",
                    "خطأ، الانتفاع ليس له حدود.",
                    "خطأ، لا علاقة لها بالأخلاق."
                ],
                "correct": 1
            },
            {
                "question": "للإيمان دور كبير في عمارة الأرض، حيث يجازى العبد على كل فعل سليم.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان لا يؤثر على عمارة الأرض.",
                    "خطأ، الإيمان يسبب الإهمال.",
                    "خطأ، عمارة الأرض ليست من واجبات المؤمن."
                ],
                "correct": 0
            },
            {
                "question": "التفاوض هو أسلوب من أساليب حل النزاعات وتسوية الصراعات بين طرفين مختلفين عن طريق القتال والمساومة والاغراءات.",
                "options": [
                    "صحيح",
                    "خطأ، التفاوض هو أسلوب من أساليب حل النزاعات بشكل سلمي توافقي لا قتال فيه.",
                    "خطأ، التفاوض يتم عن طريق الغزو والقتال.",
                    "خطأ، لا يوجد تفاوض في الإسلام."
                ],
                "correct": 1
            },
            {
                "question": "من فوائد التفاوض أنه يقدم المصلحة الشخصية عن المصلحة العامة.",
                "options": [
                    "صحيح",
                    "خطأ، بل يقدم المصلحة العامة التي تهم الجماعة وليس الفرد.",
                    "خطأ، يتوازن بين المصلحة الشخصية والمصلحة العامة.",
                    "خطأ، لا يهتم بأي مصلحة."
                ],
                "correct": 1
            },
            {
                "question": "انتشار الإسلام جاء بقوة المسلمين وشجاعتهم في الحرب والقتال ومواجهة المشركين بقوة السيف.",
                "options": [
                    "صحيح",
                    "خطأ، الإسلام نشر لأنه دين الحق ووجد فيه الناس الراحة والطمأنينة القلبية.",
                    "خطأ، انتشار الإسلام كان عن طريق الحرب فقط.",
                    "خطأ، لم ينتشر الإسلام."
                ],
                "correct": 1
            },
            {
                "question": "فتح مكة أو الفتح الأعظم كان في 30 رمضان سنة 7 للهجرة.",
                "options": [
                    "صحيح",
                    "خطأ، كان في 20 رمضان سنة 8 للهجرة.",
                    "خطأ، كان في 10 رمضان سنة 8 للهجرة.",
                    "خطأ، لم يحدث فتح مكة."
                ],
                "correct": 1
            },
            {
                "question": "من نتائج فتح مكة: عفو الرسول صلى الله عليه وسلم عن أهل مكة وقوله: \"اذهبوا فأنتم الطلقاء\".",
                "options": [
                    "صحيح",
                    "خطأ، بل أعدم الرسول جميع من اعتدى على المسلمين.",
                    "خطأ، تم إعدام البعض ولكن ليس جميعهم.",
                    "خطأ، لم يعف عن أحد."
                ],
                "correct": 0
            },
            {
                "question": "تنعكس معالم الإيمان بالغيب على سلوكات الأفراد في معاملاتهم مع الناس مسلمين كانوا أو غير مسلمين.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان يؤثر فقط على حياة المسلم.",
                    "خطأ، الغيب ليس له تأثير على السلوك.",
                    "خطأ، الإيمان يؤثر فقط في العلاقة مع الله."
                ],
                "correct": 0
            },
            {
                "question": "يوجب ديننا الإيمان بكل شيء لا علم لنا به، مادياً كان أو معنوياً، وهذا عين الغيب.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان القطعي مرتبط بما أخبرنا به الله تعالى فقط.",
                    "خطأ، يجب الإيمان بكل شيء حتى لا نخطئ.",
                    "خطأ، الإيمان يعتمد على التجربة فقط."
                ],
                "correct": 1
            },
            {
                "question": "العقل هو أساس الإيمان، فما قبله العقل هو حق، وما لم يقبله هو باطل.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان يحث على إعمال العقل، شريطة أن يلتزم بالحق.",
                    "خطأ، العقل ليس له تأثير على الإيمان.",
                    "خطأ، الإيمان يتجاوز العقل."
                ],
                "correct": 1
            },
            {
                "question": "للإيمان بالغيب آثار في الآخرة بالفلاح ودخول الجنة، ولا يمكن اعتبار أن له انعكاسات في الدنيا.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان بالغيب تنعكس آثاره على سلوكيات الأفراد.",
                    "خطأ، الإيمان لا يؤثر على الدنيا.",
                    "خطأ، الإيمان يسبب مشاكل في الدنيا."
                ],
                "correct": 1
            },
            {
                "question": "أزمات المجتمع التي نعيشها في الواقع سببها الانشغال بالإيمان الذي يحث على العبادة وترك الدنيا.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان الحق يشمل جميع مناحي الحياة.",
                    "خطأ، الإيمان يؤثر سلباً على المجتمع.",
                    "خطأ، الإيمان ليس له تأثير على الأزمات."
                ],
                "correct": 1
            },
            {
                "question": "العلم هو طريق لمعرفة الله وترسيخ الإيمان شريطة أن يكون هذا العلم إسلامي فقط.",
                "options": [
                    "صحيح",
                    "خطأ، كل العلوم تعد طريق لمعرفة الله.",
                    "خطأ، يجب أن يكون العلم في الدين فقط.",
                    "خطأ، العلم ليس له علاقة بالله."
                ],
                "correct": 1
            },
            {
                "question": "النبي صلى الله عليه وسلم كان يحث على تعلم اللغة، وطلب العلم، حتى ولو كان هذا العلم يخص الكفار.",
                "options": [
                    "صحيح",
                    "خطأ، لا يجب تعلم علم الكفار.",
                    "خطأ، العلم يجب أن يكون إسلامياً فقط.",
                    "خطأ، العلم ليس له أهمية في الإسلام."
                ],
                "correct": 0
            },
            {
                "question": "جميع العلوم دالة على عظمة الله، وترسخ الإيمان بالله سواء كانت رياضيات أو فيزياء أو فلك.",
                "options": [
                    "صحيح",
                    "خطأ، العلوم الطبيعية لا تتعلق بالإيمان.",
                    "خطأ، فقط العلوم الدينية تدل على عظمة الله.",
                    "خطأ، العلوم تشتت الإيمان."
                ],
                "correct": 0
            },
            {
                "question": "كلما تعلم الإنسان إلا وزاد إيمانه، وكلما زاد إيمانه تقوى قربه من الله.",
                "options": [
                    "صحيح",
                    "خطأ، التعلم لا يؤثر على الإيمان.",
                    "خطأ، التعلم قد يؤدي إلى الشك.",
                    "خطأ، الإيمان مستقل عن المعرفة."
                ],
                "correct": 0
            },
            {
                "question": "يقال إن العلم يتكامل مع الإيمان في جزئيات كثيرة، ولا يتعارضان إلا في جزئية واحدة أو جزئيتين.",
                "options": [
                    "صحيح",
                    "خطأ، لا يوجد أي تعارض بين الإيمان والعلم.",
                    "خطأ، العلم والإيمان يتعارضان في كثير من الأحيان.",
                    "خطأ، الإيمان هو فقط ما يمكن تصديقه."
                ],
                "correct": 1
            },
            {
                "question": "التفكير الفلسفي هو عملية ذهنية قائمة على إعمال العقل بالتأمل في العديد من الظواهر الكونية والعلمية.",
                "options": [
                    "صحيح",
                    "خطأ، التفكير الفلسفي لا يفيد في الإيمان.",
                    "خطأ، التفكير الفلسفي يبعد عن الحق.",
                    "خطأ، التفكير الفلسفي هو مجرد شك."
                ],
                "correct": 0
            },
            {
                "question": "من سلبيات التفكير الفلسفي أنه يقود أحياناً إلى الكفر والإلحاد.",
                "options": [
                    "صحيح",
                    "خطأ، التفكير الفلسفي الحق دائماً يرسخ الإيمان.",
                    "خطأ، الفلسفة لا تفيد في شيء.",
                    "خطأ، التفكير الفلسفي هو طريق الإيمان فقط."
                ],
                "correct": 1
            },
            {
                "question": "ما دام أن الفلسفة قائمة على الإلحاد، وغايتها الوصول إلى الحقيقة، إذا فلا مجال لارتباطها بالإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، الفلسفة كمنهج يرتبط مع الإيمان.",
                    "خطأ، الفلسفة لا تتعلق بالإيمان.",
                    "خطأ، الإيمان هو فقط ما ينقله الوحي."
                ],
                "correct": 1
            },
            {
                "question": "يرتبط المنهج الفلسفي الموضوعي بالمنهج التأملي، والمنهج العقلي، والمنهج التحليلي.",
                "options": [
                    "صحيح",
                    "خطأ، المنهج الفلسفي لا يتعلق بالتأمل.",
                    "خطأ، المنهج الفلسفي هو منهج ديني فقط.",
                    "خطأ، المنهج الفلسفي يعتمد على الإيمان فقط."
                ],
                "correct": 0
            },
            {
                "question": "المنهج الفلسفي الموضوعي يعطيك ملكة التأمل في ذات الله ومعرفة كل جزئيات، وهذا ما يحث عليه الإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، التأمل في ذات الله محرم.",
                    "خطأ، المنهج الفلسفي لا يفيد في الإيمان.",
                    "خطأ، المنهج الفلسفي يعتمد على الشك."
                ],
                "correct": 1
            },
            {
                "question": "الإيمان يحث على إعمال العقل، والفلسفة تحث على التخلص من الإيمان.",
                "options": [
                    "صحيح",
                    "خطأ، كلاهما يشتركان في إعمال العقل.",
                    "خطأ، الفلسفة لا تتعلق بالإيمان.",
                    "خطأ، الإيمان يقيد العقل."
                ],
                "correct": 1
            },
            {
                "question": "من صفات الفلسفة الراشدة أن تجمع بين النقل (الوحي) والعقل.",
                "options": [
                    "صحيح",
                    "خطأ، الفلسفة لا تتعلق بالدين.",
                    "خطأ، الفلسفة تعتمد على العقل فقط.",
                    "خطأ، النقل لا يفيد في الفلسفة."
                ],
                "correct": 0
            },
            {
                "question": "صلح الحديبية تم بين المسلمين وكفار قريش بمكان قرب المدينة اسمه الحديبية.",
                "options": [
                    "صحيح",
                    "خطأ، صلح الحديبية تم بين المسلمين وكفار قريش بمكان قرب مكة اسمه الحديبية.",
                    "خطأ، صلح الحديبية تم بين المسلمين واليهود قرب مكة.",
                    "خطأ، تم الصلح في المدينة."
                ],
                "correct": 1
            },
            {
                "question": "صلح الحديبية تم في شهر ذي الحجة سنة 5 للهجرة.",
                "options": [
                    "صحيح",
                    "خطأ، صلح الحديبية تم في شهر ذي القعدة سنة 6 للهجرة.",
                    "خطأ، صلح الحديبية تم في شهر رجب سنة 5 للهجرة.",
                    "خطأ، تم في شهر رمضان."
                ],
                "correct": 1
            },
            {
                "question": "سبب صلح الحديبية أن رسول الله صلى الله عليه وسلم رأى رؤيا في المنام (وهو بالمدينة) أنه دخل هو وأصحابه المسجد الحرام.",
                "options": [
                    "صحيح",
                    "خطأ، بل كان السبب دعوة من كفار قريش للصلح.",
                    "خطأ، السبب كان لحماية المسلمين من الأذى في مكة.",
                    "خطأ، لم تكن هناك رؤيا."
                ],
                "correct": 0
            },
            {
                "question": "خرج الرسول صلى الله عليه وسلم يريد العمرة ومعه 1400 من الصحابة مسلحين للحرب.",
                "options": [
                    "صحيح",
                    "خطأ، خرج الرسول صلى الله عليه وسلم، يريد العمرة ومعه 1400 من الصحابة بشكل سلمي لا غرض لهم في الحرب.",
                    "خطأ، بل خرج ومعه 1000 من الصحابة فقط.",
                    "خطأ، خرج مسلحاً للقتال."
                ],
                "correct": 1
            },
            {
                "question": "الزواج هو ميثاق يتفق حوله الزوج مع الزوجة على أساس بناء علاقة شرعية محددة بزمان ومكان.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج ميثاق غليظ قائم على المودة والرحمة.",
                    "خطأ، الزواج عقد مؤقت.",
                    "خطأ، الزواج لا يحتاج لاتفاق."
                ],
                "correct": 1
            },
            {
                "question": "الزواج محرم في حق من لا يملك أموال كثيرة، وأملاك وأراضي.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج ليس مرتبطاً بكثرة المال.",
                    "خطأ، يشترط المال الكثير.",
                    "خطأ، الزواج فقط للأغنياء."
                ],
                "correct": 1
            },
            {
                "question": "الحكم الأصلي للزواج هو الإباحة.",
                "options": [
                    "صحيح",
                    "خطأ، الحكم الأصلي هو الاستحباب.",
                    "خطأ، الحكم الأصلي هو الوجوب.",
                    "خطأ، الحكم الأصلي هو الكراهة."
                ],
                "correct": 1
            },
            {
                "question": "شرع الله الزواج، وأحل معه خيار توثيقه على الدوام أو بالمدة المحددة.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج المؤقت محرم في الإسلام.",
                    "خطأ، فقط الزواج الدائم مشروع.",
                    "خطأ، كلاهما محرم."
                ],
                "correct": 1
            },
            {
                "question": "للزواج أكثر من حكم شرعي في الإسلام.",
                "options": [
                    "صحيح",
                    "خطأ، الزواج له حكم واحد فقط.",
                    "خطأ، دائمًا محرم.",
                    "خطأ، دائماً مستحب."
                ],
                "correct": 0
            },
            {
                "question": "أركان الزواج أربعة وهي: الصيغة، الولي، الاشهاد، العقد.",
                "options": [
                    "صحيح",
                    "خطأ، الأركان ثلاثة: الصيغة والولي والشاهدان.",
                    "خطأ، الأركان خمسة.",
                    "خطأ، لا توجد أركان للزواج."
                ],
                "correct": 1
            },
            {
                "question": "الحقوق هي المصالح الثابتة للفرد أو الجماعة المادية أو المعنوية التي يقرها الشرع أو القانون.",
                "options": [
                    "صحيح",
                    "خطأ، الحقوق فقط ما يقره الشرع.",
                    "خطأ، الحقوق فقط مادية.",
                    "خطأ، لا توجد حقوق ثابتة."
                ],
                "correct": 0
            },
            {
                "question": "الحقوق في الإسلام هي ربانية المصدر، وملزمة ومرتبطة بالجزاء، وشاملة لجميع التخصصات.",
                "options": [
                    "صحيح",
                    "خطأ، الحقوق ليست ربانية المصدر.",
                    "خطأ، الحقوق غير ملزمة.",
                    "خطأ، الحقوق محدودة النطاق."
                ],
                "correct": 0
            },
            {
                "question": "الأمانة هي صفة نفسية وقلبية عالمية يعف بها الإنسان عن حقوق الآخرين.",
                "options": [
                    "صحيح",
                    "خطأ، الأمانة صفة محلية فقط.",
                    "خطأ، الأمانة لا تتعلق بحقوق الآخرين.",
                    "خطأ، الأمانة ليست صفة قلبية."
                ],
                "correct": 0
            },
            {
                "question": "الوفاء بالأمانة والمسؤولية يساهم في نشر الثقة بين أفراد المجتمع.",
                "options": [
                    "صحيح",
                    "خطأ، لا يؤثر على الثقة.",
                    "خطأ، يقلل من الثقة.",
                    "خطأ، لا علاقة له بالمجتمع."
                ],
                "correct": 0
            },
            {
                "question": "الصبر هو قدرة الإنسان على تحمل الشدائد والابتلاءات دون جزع.",
                "options": [
                    "صحيح",
                    "خطأ، الصبر هو عدم المقاومة.",
                    "خطأ، الصبر هو الاستسلام.",
                    "خطأ، الصبر لا يتعلق بالابتلاءات."
                ],
                "correct": 0
            },
            {
                "question": "اليقين هو العلم الراسخ الذي لا يعكره شك.",
                "options": [
                    "صحيح",
                    "خطأ، اليقين هو الشك المبرر.",
                    "خطأ، اليقين هو الظن القوي.",
                    "خطأ، اليقين متغير."
                ],
                "correct": 0
            },
            {
                "question": "العفو هو التجاوز عن المذنب مع القدرة على معاقبته.",
                "options": [
                    "صحيح",
                    "خطأ، العفو هو عدم القدرة على المعاقبة.",
                    "خطأ، العفو هو الانتقام.",
                    "خطأ، العفو هو التجاهل."
                ],
                "correct": 0
            },
            {
                "question": "التسامح هو التساهل واليسر في المعاملات المالية والاجتماعية.",
                "options": [
                    "صحيح",
                    "خطأ، التسامح هو التشدد.",
                    "خطأ، التسامح لا يشمل المعاملات.",
                    "خطأ، التسامح فقط في الدين."
                ],
                "correct": 0
            },
            {
                "question": "العفو والتسامح هما صفات يمكن أن تتواجد في حق المذنبين فقط.",
                "options": [
                    "صحيح",
                    "خطأ، العفو والتسامح صفات عامة في التعامل.",
                    "خطأ، لا يوجد عفو للمذنبين.",
                    "خطأ، التسامح فقط مع الأبرياء."
                ],
                "correct": 1
            },
            {
                "question": "الوفاء بالعقود يعتبر واجبًا في الإسلام.",
                "options": [
                    "صحيح",
                    "خطأ، الوفاء بالعقود مستحب فقط.",
                    "خطأ، العقود غير ملزمة.",
                    "خطأ، يجوز نقض العقود."
                ],
                "correct": 0
            },
            {
                "question": "العفة هي خلق يلتزم به الفرد في حياتهم اليومية.",
                "options": [
                    "صحيح",
                    "خطأ، العفة فقط في المناسبات.",
                    "خطأ، العفة غير ضرورية.",
                    "خطأ، العفة للنساء فقط."
                ],
                "correct": 0
            },
            {
                "question": "الحياء هو خلق ينبع من الفرد ليجنب نفسه الفعل القبيح.",
                "options": [
                    "صحيح",
                    "خطأ، الحياء هو الخجل فقط.",
                    "خطأ، الحياء هو الضعف.",
                    "خطأ، الحياء لا يمنع القبائح."
                ],
                "correct": 0
            },
            {
                "question": "العفة والحياء يساهمان في الحد من الفواحش في المجتمع.",
                "options": [
                    "صحيح",
                    "خطأ، لا يؤثران على المجتمع.",
                    "خطأ، يزيدان من الفواحش.",
                    "خطأ، لا علاقة لهما بالفواحش."
                ],
                "correct": 0
            },
            {
                "question": "الفواحش تشمل جميع القبيح من الكلمات والأفعال.",
                "options": [
                    "صحيح",
                    "خطأ، الفواحش فقط الأفعال.",
                    "خطأ، الفواحش فقط الكلمات.",
                    "خطأ، لا توجد فواحش."
                ],
                "correct": 0
            },
            {
                "question": "عمارة الأرض وإعمارها واجب على كل مؤمن ومؤمنة، ومن أفسد فيها يعد من الفاسدين في الأرض.",
                "options": [
                    "صحيح",
                    "خطأ، الإفساد ليس له تأثير.",
                    "خطأ، عمارة الأرض ليست واجباً.",
                    "خطأ، المؤمنين ليسوا ملزمين بذلك."
                ],
                "correct": 0
            },
            {
                "question": "عمارة الأرض هي تعميرها بالانتفاع بخيراتها المادية فقط.",
                "options": [
                    "صحيح",
                    "خطأ، عمارة الأرض تشمل العمل الصالح مادياً ومعنوياً.",
                    "خطأ، الانتفاع ليس له حدود.",
                    "خطأ، لا علاقة لها بالأخلاق."
                ],
                "correct": 1
            },
            {
                "question": "للإيمان دور كبير في عمارة الأرض، حيث يجازى العبد على كل فعل سليم.",
                "options": [
                    "صحيح",
                    "خطأ، الإيمان لا يؤثر على عمارة الأرض.",
                    "خطأ، الإيمان يسبب الإهمال.",
                    "خطأ، عمارة الأرض ليست من واجبات المؤمن."
                ],
                "correct": 0
            },
            {
                "question": "التفاوض هو أسلوب من أساليب حل النزاعات وتسوية الصراعات بين طرفين مختلفين عن طريق القتال والمساومة والاغراءات.",
                "options": [
                    "صحيح",
                    "خطأ، التفاوض هو أسلوب من أساليب حل النزاعات بشكل سلمي توافقي لا قتال فيه.",
                    "خطأ، التفاوض يتم عن طريق الغزو والقتال.",
                    "خطأ، لا يوجد تفاوض في الإسلام."
                ],
                "correct": 1
            },
            {
                "question": "من فوائد التفاوض أنه يقدم المصلحة الشخصية عن المصلحة العامة.",
                "options": [
                    "صحيح",
                    "خطأ، بل يقدم المصلحة العامة التي تهم الجماعة وليس الفرد.",
                    "خطأ، يتوازن بين المصلحة الشخصية والمصلحة العامة.",
                    "خطأ، لا يهتم بأي مصلحة."
                ],
                "correct": 1
            },
            {
                "question": "انتشار الإسلام جاء بقوة المسلمين وشجاعتهم في الحرب والقتال ومواجهة المشركين بقوة السيف.",
                "options": [
                    "صحيح",
                    "خطأ، الإسلام نشر لأنه دين الحق ووجد فيه الناس الراحة والطمأنينة القلبية.",
                    "خطأ، انتشار الإسلام كان عن طريق الحرب فقط.",
                    "خطأ، لم ينتشر الإسلام."
                ],
                "correct": 1
            },
            {
                "question": "فتح مكة أو الفتح الأعظم كان في 30 رمضان سنة 7 للهجرة.",
                "options": [
                    "صحيح",
                    "خطأ، كان في 20 رمضان سنة 8 للهجرة.",
                    "خطأ، كان في 10 رمضان سنة 8 للهجرة.",
                    "خطأ، لم يحدث فتح مكة."
                ],
                "correct": 1
            },
            {
                "question": "من نتائج فتح مكة: عفو الرسول صلى الله عليه وسلم عن أهل مكة وقوله: \"اذهبوا فأنتم الطلقاء\".",
                "options": [
                    "صحيح",
                    "خطأ، بل أعدم الرسول جميع من اعتدى على المسلمين.",
                    "خطأ، تم إعدام البعض ولكن ليس جميعهم.",
                    "خطأ، لم يعف عن أحد."
                ],
                "correct": 0
            }
        ]
    },
    "second-bac-math": {
        "title": "اختبار الرياضيات - الثانية بكالوريا",
        "duration": 50,
        "questions": [
            {
                "question": "ما هو مشتق الدالة f(x) = x²؟",
                "options": [
                    "x",
                    "2x",
                    "x²",
                    "2"
                ],
                "correct": 1
            },
            {
                "question": "ما هو حل المعادلة x² - 4 = 0؟",
                "options": [
                    "x = 2",
                    "x = ±2",
                    "x = 4",
                    "x = ±4"
                ],
                "correct": 1
            },
            {
                "question": "ما هو قيمة sin(90°)؟",
                "options": [
                    "0",
                    "1",
                    "-1",
                    "0.5"
                ],
                "correct": 1
            }
        ]
    },
    "second-bac-physics": {
        "title": "اختبار الفيزياء - الثانية بكالوريا",
        "duration": 45,
        "questions": [
            {
                "question": "ما هي وحدة قياس القوة في النظام الدولي؟",
                "options": [
                    "جول",
                    "نيوتن",
                    "واط",
                    "فولت"
                ],
                "correct": 1
            },
            {
                "question": "ما هي سرعة الضوء في الفراغ؟",
                "options": [
                    "3×10⁸ m/s",
                    "3×10⁷ m/s",
                    "3×10⁹ m/s",
                    "3×10⁶ m/s"
                ],
                "correct": 0
            }
        ]
    },
    "second-bac-biology": {
        "title": "اختبار علوم الحياة والأرض - الثانية بكالوريا",
        "duration": 40,
        "questions": [
            {
                "question": "ما هي وحدة الوراثة الأساسية؟",
                "options": [
                    "الكروموسوم",
                    "الجين",
                    "الخلية",
                    "النواة"
                ],
                "correct": 1
            },
            {
                "question": "كم عدد الكروموسومات في الخلية البشرية العادية؟",
                "options": [
                    "23",
                    "44",
                    "46",
                    "48"
                ],
                "correct": 2
            }
        ]
    },
    "second-bac-philosophy": {
        "title": "اختبار الفلسفة - الثانية بكالوريا",
        "duration": 35,
        "questions": [
            {
                "question": "من هو فيلسوف العقلانية الحديثة؟",
                "options": [
                    "أفلاطون",
                    "ديكارت",
                    "كانط",
                    "نيتشه"
                ],
                "correct": 1
            },
            {
                "question": "ما هو المبدأ الأساسي للفلسفة الوجودية؟",
                "options": [
                    "الوجود يسبق الماهية",
                    "الماهية تسبق الوجود",
                    "لا وجود بلا ماهية",
                    "الماهية والوجود متطابقان"
                ],
                "correct": 0
            }
        ]
    },
    "second-bac-english": {
        "title": "اختبار الإنجليزية - الثانية بكالوريا",
        "duration": 40,
        "questions": [
            {
                "question": "Choose the correct form: \"I have ____ this book.\"",
                "options": [
                    "read",
                    "readed",
                    "reading",
                    "reads"
                ],
                "correct": 0
            },
            {
                "question": "Which is the correct passive form of \"They built a house\"?",
                "options": [
                    "A house built by them",
                    "A house was built by them",
                    "A house is built by them",
                    "A house has built by them"
                ],
                "correct": 1
            }
        ]
    }
};

// دالة تهيئة الاختبار - تستدعى عند تحميل الصفحة
function initializeTest() {
    // استخراج المعاملات من رابط الصفحة (المستوى والمادة)
    const urlParams = new URLSearchParams(window.location.search);
    const level = urlParams.get('level');        // مثل: first-bac, second-bac
    const subject = urlParams.get('subject');    // مثل: french, arabic, math
    
    // التحقق من وجود المعاملات المطلوبة
    if (!level || !subject) {
        // إذا لم توجد المعاملات، العودة لصفحة الاختبارات
        window.location.href = 'tests.html';
        return;
    }
    
    const testKey = `${level}-${subject}`;
    testData = sampleQuestions[testKey] || sampleQuestions['first-bac-french'];
    
    document.getElementById('test-title').textContent = testData.title;
    document.getElementById('total-questions').textContent = testData.questions.length;
    
    // Calculate duration based on number of questions (60 seconds per question)
    const calculatedDuration = Math.ceil((testData.questions.length * 60) / 60);
    document.getElementById('test-duration').textContent = calculatedDuration + ' دقيقة';
    
    userAnswers = new Array(testData.questions.length).fill(-1);
    
    displayQuestion();
}

// Display current question
function displayQuestion() {
    const question = testData.questions[currentQuestionIndex];
    const container = document.getElementById('questions-container');
    
    container.innerHTML = `
        <div class="question-container">
            <div class="question-number">${currentQuestionIndex + 1}</div>
            <div class="question-timer">وقت السؤال: <span id="question-time">${questionTimeRemaining}</span> ثانية</div>
            <div class="question-text">${question.question}</div>
            <div class="options-container">
                ${question.options.map((option, index) => `
                    <div class="option ${userAnswers[currentQuestionIndex] === index ? 'selected' : ''}" 
                         onclick="selectOption(${index})">
                        <strong>${String.fromCharCode(65 + index)}.</strong> ${option}
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    updateProgress();
    updateNavigation();
    startQuestionTimer();
}

// Start question timer
function startQuestionTimer() {
    clearInterval(questionTimerInterval);
    questionTimeRemaining = 60;
    
    questionTimerInterval = setInterval(() => {
        questionTimeRemaining--;
        const questionTimeElement = document.getElementById('question-time');
        if (questionTimeElement) {
            questionTimeElement.textContent = questionTimeRemaining;
            
            if (questionTimeRemaining <= 5) {
                questionTimeElement.style.color = 'red';
                questionTimeElement.style.fontWeight = 'bold';
            }
        }
        
        if (questionTimeRemaining <= 0) {
            clearInterval(questionTimerInterval);
            // Auto move to next question if time is up
            if (currentQuestionIndex < testData.questions.length - 1) {
                nextQuestion();
            } else {
                submitTest();
            }
        }
    }, 1000);
}

// Select an option
function selectOption(optionIndex) {
    userAnswers[currentQuestionIndex] = optionIndex;
    
    // Update visual selection
    document.querySelectorAll('.option').forEach((option, index) => {
        option.classList.toggle('selected', index === optionIndex);
    });
}

// Navigation functions
function nextQuestion() {
    clearInterval(questionTimerInterval);
    if (currentQuestionIndex < testData.questions.length - 1) {
        currentQuestionIndex++;
        displayQuestion();
    }
}

function previousQuestion() {
    clearInterval(questionTimerInterval);
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        displayQuestion();
    }
}

// Update progress bar and navigation
function updateProgress() {
    const progress = ((currentQuestionIndex + 1) / testData.questions.length) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('current-question').textContent = currentQuestionIndex + 1;
}

function updateNavigation() {
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    
    prevBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'block';
    
    if (currentQuestionIndex === testData.questions.length - 1) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'block';
    } else {
        nextBtn.style.display = 'block';
        submitBtn.style.display = 'none';
    }
}



// Submit test
function submitTest() {
    clearInterval(questionTimerInterval);
    
    // Calculate score
    let correctAnswers = 0;
    let wrongAnswers = [];
    
    testData.questions.forEach((question, index) => {
        if (userAnswers[index] === question.correct) {
            correctAnswers++;
        } else {
            wrongAnswers.push({
                questionIndex: index,
                question: question.question,
                userAnswer: userAnswers[index] !== -1 ? question.options[userAnswers[index]] : 'لم يتم الإجابة',
                correctAnswer: question.options[question.correct]
            });
        }
    });
    
    const score = Math.round((correctAnswers / testData.questions.length) * 100);
    
    // Show results
    document.getElementById('questions-container').style.display = 'none';
    document.querySelector('.navigation-buttons').style.display = 'none';
    document.querySelector('.test-info').style.display = 'none';
    document.querySelector('.progress-bar').style.display = 'none';
    
    const resultContainer = document.getElementById('result-container');
    document.getElementById('final-score').textContent = score + '%';
    
    let message = '';
    if (score >= 90) {
        message = 'ممتاز! أداء رائع';
    } else if (score >= 80) {
        message = 'جيد جداً! استمر في التميز';
    } else if (score >= 70) {
        message = 'جيد! يمكنك التحسن أكثر';
    } else if (score >= 60) {
        message = 'مقبول، تحتاج لمزيد من المراجعة';
    } else {
        message = 'ضعيف، تحتاج لمراجعة شاملة';
    }
    
    document.getElementById('result-message').textContent = message;
    
    // Show wrong answers
    if (wrongAnswers.length > 0) {
        const wrongAnswersHtml = wrongAnswers.map((item, index) => `
            <div class="wrong-answer-item">
                <h4>السؤال ${item.questionIndex + 1}</h4>
                <p class="question-text">${item.question}</p>
                <p class="user-answer">إجابتك: <span class="wrong">${item.userAnswer}</span></p>
                <p class="correct-answer">الإجابة الصحيحة: <span class="correct">${item.correctAnswer}</span></p>
            </div>
        `).join('');
        
        const reviewSection = document.createElement('div');
        reviewSection.className = 'review-section';
        reviewSection.innerHTML = `
            <h3>مراجعة الأخطاء (${wrongAnswers.length} خطأ)</h3>
            ${wrongAnswersHtml}
        `;
        
        resultContainer.appendChild(reviewSection);
    }
    
    resultContainer.style.display = 'block';
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', initializeTest);
